name: Build

on:
  push:
  pull_request_target:
    types: [labeled]

jobs: 
  build:
    name: Test
    runs-on: ubuntu-latest
    if: "!contains(github.event.head_commit.message, '[ci skip]') && !contains(github.event.head_commit.message, '[skip ci]')"
    steps:
      - uses: actions/checkout@v2
        with:
          submodules: true
          fetch-depth: 0
      - uses: actions/setup-java@v1
        with:
          java-version: 11
      - name: Build
        run: bash ./gradlew assembleApkstoreRelease --stacktrace
      - uses: r0adkll/sign-android-release@v1
        name: Sign app APK
        # ID used to access action output
        id: sign_app
        with:
          releaseDirectory: presentation/build/outputs/apk/apkstore/release
          signingKeyBase64: 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
          alias: UNTRUSTED
          keyStorePassword: password
      - uses: actions/upload-artifact@v3
        with:
          name: ReleaseAPK
          path: ${{steps.sign_app.outputs.signedReleaseFile}}
